## Описание
Cкрипт для мониторинга процесса `test` в среде Linux.  
Логирует запуск и перезапуск процесса, а также ошибки при недоступности сервера мониторинга.

## Как работает скрипт

1. Скрипт проверяет, запущен ли процесс с именем `test`:

   - Если процесса нет → скрипт просто выходит, PID-файл удаляется.  
   - Если процесс есть → продолжается работа.  

2. Скрипт сравнивает текущий PID процесса с предыдущим, сохранённым в PID-файле:

   - Если PID изменился → процесс был перезапущен, в лог записывается `[INFO] Процесс 'test' перезапущен`.  
   - Если PID совпадает → процесс продолжает работать, в лог ничего не пишется (кроме первоначального запуска).  

3. Скрипт пытается отправить POST-запрос на сервер мониторинга:

   - Если сервер недоступен → в лог записывается `[ERROR] Сервер недоступен`.  
   - Если сервер доступен → запрос проходит тихо, в лог ничего не пишется.  

4. PID текущего процесса сохраняется в `/var/lib/test_monitor/test.pid`, лог записывается в `/var/log/monitoring.log`.

5. Systemd-таймер запускает скрипт каждую минуту, чтобы непрерывно отслеживать процесс и доступность сервера.


## Структура проекта
- `monitoring.sh` — скрипт мониторинга процесса.
- `monitoring.service` — systemd-сервис для запуска скрипта.
- `monitoring.timer` — systemd-таймер для периодического запуска скрипта.

## Установка
1. **Клонируем репозиторий**
```bash
git clone https://github.com/Lil-Krl/process_test_monitor.git
cd process_test_monitor
```
2. **Копируем файлы**
Копируем скрипт в `/usr/local/bin` и даем права на выполнение:
```bash
sudo cp monitoring.sh /usr/local/bin/
sudo chmod +x /usr/local/bin/monitoring.sh
```

Копируем systemd-файлы в директорию `system`:
```bash
sudo cp monitoring.service monitoring.timer /etc/systemd/system/
```
3. **Перезагружаем systemd и активируем таймер**
```bash
sudo systemctl daemon-reload
sudo systemctl enable --now monitoring.timer
```

## Проверка работы
Скрипт можно проверить на любом процессе, который уже есть в системе. Например, временно используем `sleep`. Для этого в файле `monitoring.sh` меняем значение `PROC`
```bash
PROC="sleep"
```
После этого запускаем процесс:
```bash
sleep 300 &
```
**Проверить, что процесс запущен**
```bash
pgrep -x sleep
```
**Запуск скрипта**
```bash
sudo /usr/local/bin/monitoring.sh
```
**Проверка логов**
```bash
sudo tail -n 20 /var/log/monitoring.log
```
**Проверка перезапуска процесса**
```bash
pkill sleep
sleep 300 &
sudo /usr/local/bin/monitoring.sh
sudo tail -n 20 /var/log/monitoring.log
```
